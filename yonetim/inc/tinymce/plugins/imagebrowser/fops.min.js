/*
**  Image Browser 1.0.0
**  Plugin for TinyMCE
**  https://github.com/hozakar/imagebrowser-for-tinymce
**
**  Copyright 2014, Hakan Ã–zakar
**  http://beltslib.net
**
**  Licensed under CC0 1.0 Universal Licence:
**  https://creativecommons.org/publicdomain/zero/1.0/
*/
"use strict";function deletePic(e){e=$(e).parents("li")[0],confirm($("#conf_file_delete").val())&&($(".images").find("li").removeClass("selected"),$(e).addClass("selected"),opset("delete"))}function opset(e){if("paste"==e){var a=$("#fileopform").serialize();a+="&paste=1",$.ajax({type:"POST",url:"fops.php",data:a}).done(function(){location.reload()})}else{$("[name=opdir]").val($("[name=root]").val()),$("[name=optype]").val(e);for(var t=$(".images li.selected"),i=new Array,l=0;l<t.length;l++)i.push($(t[l]).attr("title"));$("[name=files]").val(i.join(","));var a=$("#fileopform").serialize();"delete"==e?$("#fileopform").submit():$.ajax({type:"POST",url:"fops.php",data:a})}}function del(){confirm($("#conf_sel_file_delete").val())&&opset("delete")}function cx(){if($(".images li.selected").length){var e=$(".images li.selected"),a=$(".images li");a.removeClass("cut"),e.addClass("cut"),opset("cut")}}function cv(){opset("paste")}function cc(){if($(".images li.selected").length){var e=$(".images li");e.removeClass("cut"),opset("copy")}}$(function(){var e=0;$(".images li").click(function(e){e.stopPropagation()}),$(".fileblock").click(function(){$(".images li").removeClass("selected"),$("input[name=selfile]").val("")}),$(".imgfile").dblclick(function(){e||$(parent.document).find(".mce-okbtn button[role=presentation]").click()}),$(".imgfile").click(function(){switch(e){case 0:$(this).parents(".images").find("li").removeClass("selected"),$(this.parentNode).toggleClass("selected");break;case 17:$(this.parentNode).toggleClass("selected");break;default:var a,t,i=$(this).parents(".images").find("li.selected")[0],l=this.parentNode;i||(i=l);var n=$(this).parents(".images").find("li");$(n).removeClass("selected");for(var o=0;o<n.length;o++)n[o]==i&&(a=o),n[o]==l&&(t=o);for(var s=Math.min(a,t),d=Math.max(a,t),o=s;d>=o;o++)$(n[o]).addClass("selected")}if($(this.parentNode).hasClass("selected"))$("input[name=selfile]").val($(this.parentNode).data("root")+$(this.parentNode).attr("title"));else{var c=$(".images li.selected").length?$(".images li.selected")[0]:!1,r=c?$(c).data("root")+$(c).attr("title"):"";$("input[name=selfile]").val(r)}}),$("body").keyup(function(a){switch((16==a.keyCode||17==a.keyCode)&&(e-=a.keyCode),a.keyCode){case 46:if(e)return;if(!$(".images li.selected").length)return;del();break;case 88:if(17!=e)return;cx();break;case 86:if(17!=e)return;cv();break;case 67:if(17!=e)return;cc();break;case 65:if(17!=e)return;if($(".images").find("li").addClass("selected"),!$("input[name=selfile]").val()){var t=$(".images li.selected").length?$(".images li.selected")[0]:!1,i=t?$(t).data("root")+$(t).attr("title"):"";$("input[name=selfile]").val(i)}}}),$("body").keydown(function(a){(16==a.keyCode||17==a.keyCode)&&e!=a.keyCode&&17>=e&&(e+=a.keyCode)}),$(".delpic").click(function(){deletePic(this)}),$("a.adddir").click(function(){var e=$(this).find("input[name=adddir]").val();e?location.replace("?lang="+$("input[name=lang]").val()+"&ow="+$("input[name=ow]").val()+"&optype=newdir&root="+$(this).data("root")+"&newdir="+e):$(this).find("input[name=adddir]").focus()}),$("a.adddir input[name=adddir]").keyup(function(e){if(13==e.keyCode){var a=$(this).val();a&&location.replace("?lang="+$("input[name=lang]").val()+"&ow="+$("input[name=ow]").val()+"&optype=newdir&root="+$(this).parents("a.adddir").data("root")+"&newdir="+a)}}),$("a.deldir").click(function(){var e=$(this).data("dir");e&&confirm($("#conf_directory_delete").val())&&location.replace("?lang="+$("input[name=lang]").val()+"&ow="+$("input[name=ow]").val()+"&optype=deldir&root="+$(this).data("root")+"&deldir="+e)}),$(".btn-add").click(function(){$(".fileuploadbtn").click()}),$(".btn-del").click(del),$(".btn-cut").click(cx),$(".btn-copy").click(cc),$(".btn-paste").click(cv),$(".float-btn").click(function(){$(".float-btn").removeClass("selected"),$(this).addClass("selected"),$("input[name=float]").val($(".float-btn.selected").data("float"))}),$("#selwidth").change(function(){1==$(this).val()?$("[name=width]").removeClass("hidden").val("").focus():$("[name=width]").addClass("hidden").val($(this).val())});var a="fileupload/images/php/",t=new Array;$(".fileuploadbtn").fileupload({url:a,dataType:"json",done:function(e,a){$.each(a.result.files,function(e,a){$.ajax({url:"?lang="+$("input[name=lang]").val()+"&ow="+$("input[name=ow]").val()+"&optype=movefile&root="+$(".fileuploadbtn").data("root")+"&filename="+a.name}),t.push(a.name)})},stop:function(){var e=t.join(",");setTimeout(function(){location.replace("?lang="+$("input[name=lang]").val()+"&ow="+$("input[name=ow]").val()+"&root="+$(".fileuploadbtn").data("root")+"&files="+e)},250)},start:function(){$(".cover").fadeToggle(200)}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")});